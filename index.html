<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Citas Psicol√≥gicas</title>
    <meta name="description" content="Sistema de agendamiento de citas psicol√≥gicas online. Citas gratuitas disponibles.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #c7d2fe 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 20px;
        }

        .header h1 {
            color: #312e81;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        .citas-disponibles {
            display: inline-block;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .citas-disponibles i {
            margin-right: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 1.8rem;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #312e81;
            font-size: 1.8rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
        }

        .card h2 i {
            margin-right: 12px;
            color: #6366f1;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: flex;
            align-items: center;
        }

        .alert i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .modalidad-selector {
            background: #eff6ff;
            border: 2px solid #bfdbfe;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .modalidad-selector label {
            display: block;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .modalidad-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .modalidad-option {
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .modalidad-option:hover {
            border-color: #6366f1;
            transform: translateY(-2px);
        }

        .modalidad-option.active {
            border-color: #6366f1;
            background: #eef2ff;
        }

        .modalidad-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .modalidad-option i {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .modalidad-option .title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .modalidad-option .price {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .codigo-promo {
            background: #faf5ff;
            border: 2px solid #e9d5ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group label i {
            margin-right: 8px;
            color: #6366f1;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #6366f1;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .codigo-valido,
        .codigo-invalido {
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .codigo-valido {
            background: #d1fae5;
            color: #065f46;
        }

        .codigo-invalido {
            background: #fee2e2;
            color: #991b1b;
        }

        .precio-total {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .precio-total .label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }

        .precio-total .amount {
            font-size: 2rem;
            font-weight: 700;
            color: #6366f1;
        }

        .precio-total .note {
            font-size: 0.9rem;
            color: #10b981;
            margin-top: 5px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #6366f1;
            color: white;
        }

        .btn-primary:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .citas-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .cita-item {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .cita-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .cita-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .cita-nombre {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1f2937;
        }

        .cita-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-gratis {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-pagada {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-descuento {
            background: #fae8ff;
            color: #86198f;
        }

        .cita-details {
            color: #6b7280;
            font-size: 0.95rem;
        }

        .cita-details p {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .cita-details i {
            margin-right: 10px;
            width: 20px;
            color: #6366f1;
        }

        .cita-notas {
            background: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            font-size: 0.9rem;
            color: #374151;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .demo-notice {
            background: #fef3c7;
            border: 2px solid #fcd34d;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }

        .demo-notice h3 {
            color: #92400e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .demo-notice h3 i {
            margin-right: 10px;
        }

        .demo-notice p {
            color: #78350f;
            font-size: 0.95rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Sistema de Citas Psicol√≥gicas</h1>
            <p>Agenda tu consulta de manera sencilla</p>
            <div class="citas-disponibles" id="citasDisponibles">
                <i class="fas fa-gift"></i>
                <span id="citasDisponiblesTexto">Cargando...</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Formulario -->
            <div class="card">
                <h2>
                    <i class="fas fa-calendar-plus"></i>
                    Agendar Nueva Cita
                </h2>

                <div id="alertContainer"></div>

                <form id="citaForm">
                    <!-- Selector de Modalidad -->
                    <div class="modalidad-selector">
                        <label>üí≥ Modalidad de Cita</label>
                        <div class="modalidad-options">
                            <div class="modalidad-option active" data-modalidad="pagada">
                                <i class="fas fa-dollar-sign"></i>
                                <div class="title">Pagada</div>
                                <div class="price">$35.00</div>
                            </div>
                            <div class="modalidad-option" data-modalidad="gratuita" id="modalidadGratuita">
                                <i class="fas fa-gift"></i>
                                <div class="title">Gratuita</div>
                                <div class="price" id="gratuitasDisponibles">Cargando...</div>
                            </div>
                        </div>
                    </div>

                    <!-- C√≥digo Promocional -->
                    <div class="codigo-promo" id="codigoPromoSection">
                        <div class="form-group">
                            <label>
                                <i class="fas fa-percent"></i>
                                C√≥digo de Promoci√≥n (Opcional)
                            </label>
                            <input 
                                type="text" 
                                id="codigoPromocion" 
                                placeholder="PRIMERACITA"
                                style="text-transform: uppercase;">
                            <div id="codigoValidacion"></div>
                        </div>
                    </div>

                    <!-- Datos Personales -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <i class="fas fa-user"></i>
                                Nombre
                            </label>
                            <input type="text" id="nombre" required placeholder="Juan">
                        </div>
                        <div class="form-group">
                            <label>Apellido</label>
                            <input type="text" id="apellido" required placeholder="P√©rez">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-envelope"></i>
                            Email
                        </label>
                        <input type="email" id="email" required placeholder="ejemplo@email.com">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-phone"></i>
                            Tel√©fono
                        </label>
                        <input type="tel" id="telefono" required placeholder="+503 1234-5678">
                    </div>

                    <!-- Fecha y Hora -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <i class="fas fa-calendar"></i>
                                Fecha
                            </label>
                            <input type="date" id="fecha" required>
                        </div>
                        <div class="form-group">
                            <label>
                                <i class="fas fa-clock"></i>
                                Hora
                            </label>
                            <select id="hora" required>
                                <option value="">Seleccionar hora</option>
                                <option value="08:00">08:00</option>
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="12:00">12:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                                <option value="17:00">17:00</option>
                                <option value="18:00">18:00</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-file-medical"></i>
                            Motivo de Consulta
                        </label>
                        <select id="motivo" required>
                            <option value="">Seleccionar motivo</option>
                            <option value="primera_vez">Primera Consulta</option>
                            <option value="ansiedad">Ansiedad</option>
                            <option value="depresion">Depresi√≥n</option>
                            <option value="estres">Estr√©s</option>
                            <option value="relaciones">Relaciones</option>
                            <option value="autoestima">Autoestima</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Notas Adicionales (Opcional)</label>
                        <textarea id="notas" placeholder="Cualquier informaci√≥n adicional que desees compartir..."></textarea>
                    </div>

                    <!-- Precio Total -->
                    <div class="precio-total">
                        <div class="label">Total a pagar:</div>
                        <div class="amount" id="precioTotal">$35.00</div>
                        <div class="note" id="precioNota"></div>
                    </div>

                    <button type="submit" class="btn btn-primary" id="btnSubmit">
                        Agendar Cita
                    </button>
                </form>
            </div>

            <!-- Lista de Citas -->
            <div class="card">
                <h2>
                    <i class="fas fa-list"></i>
                    Citas Agendadas
                </h2>
                <div class="citas-list" id="citasList">
                    <div class="empty-state">
                        <i class="fas fa-calendar-alt"></i>
                        <p>No hay citas agendadas</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notice -->
        <div class="demo-notice">
            <h3>
                <i class="fas fa-info-circle"></i>
                Modo Demo
            </h3>
            <p>
                Esta aplicaci√≥n est√° funcionando en modo demo. C√≥digos de prueba: 
                <strong>PRIMERACITA</strong> (100% desc), 
                <strong>DESC50</strong> (50% desc), 
                <strong>BIENVENIDA</strong> (gratis)
            </p>
        </div>
    </div>

    <script>
        // Configuraci√≥n
        const API_URL = 'https://tu-api.coolify.com/api/citas'; // CAMBIAR POR TU URL REAL
        const PRECIO_BASE = 35.00;
        
        let modalidadSeleccionada = 'pagada';
        let codigoValido = null;
        let citasGratuitasDisponibles = 10;

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            setMinDate();
            cargarCitas();
            verificarCitasGratis();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Modalidad selector
            document.querySelectorAll('.modalidad-option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) return;
                    
                    document.querySelectorAll('.modalidad-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    modalidadSeleccionada = this.dataset.modalidad;
                    
                    document.getElementById('codigoPromoSection').style.display = 
                        modalidadSeleccionada === 'pagada' ? 'block' : 'none';
                    
                    calcularPrecio();
                });
            });

            // C√≥digo promocional
            let codigoTimeout;
            document.getElementById('codigoPromocion').addEventListener('input', function() {
                clearTimeout(codigoTimeout);
                const codigo = this.value.trim();
                
                if (codigo === '') {
                    codigoValido = null;
                    document.getElementById('codigoValidacion').innerHTML = '';
                    calcularPrecio();
                    return;
                }
                
                codigoTimeout = setTimeout(() => {
                    verificarCodigo(codigo);
                }, 500);
            });

            // Form submit
            document.getElementById('citaForm').addEventListener('submit', function(e) {
                e.preventDefault();
                agendarCita();
            });
        }

        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').setAttribute('min', today);
        }

        async function verificarCitasGratis() {
            try {
                const response = await fetch(`${API_URL}/gratis-disponibles`);
                if (response.ok) {
                    const data = await response.json();
                    citasGratuitasDisponibles = data.disponibles;
                }
            } catch (error) {
                console.log('Modo demo: usando datos locales');
                citasGratuitasDisponibles = parseInt(localStorage.getItem('citasGratisDisponibles') || '10');
            }
            
            actualizarDisplayCitasGratis();
        }

        function actualizarDisplayCitasGratis() {
            const textoElement = document.getElementById('citasDisponiblesTexto');
            const gratuitasElement = document.getElementById('gratuitasDisponibles');
            const modalidadElement = document.getElementById('modalidadGratuita');
            
            if (citasGratuitasDisponibles > 0) {
                textoElement.textContent = `${citasGratuitasDisponibles} citas gratuitas disponibles`;
                gratuitasElement.textContent = `${citasGratuitasDisponibles} disponibles`;
                modalidadElement.classList.remove('disabled');
            } else {
                textoElement.textContent = 'No hay citas gratuitas disponibles';
                gratuitasElement.textContent = 'No disponible';
                modalidadElement.classList.add('disabled');
            }
        }

        async function verificarCodigo(codigo) {
            const validacionElement = document.getElementById('codigoValidacion');
            validacionElement.innerHTML = '<small style="color: #6b7280;">Verificando c√≥digo...</small>';
            
            try {
                const email = document.getElementById('email').value || 'temp@email.com';
                const response = await fetch(`${API_URL}/verificar-codigo/${codigo}?email=${email}`);
                
                if (response.ok) {
                    const data = await response.json();
                    codigoValido = data;
                    
                    if (data.valido) {
                        validacionElement.innerHTML = `
                            <div class="codigo-valido">
                                ‚úÖ C√≥digo v√°lido: ${data.descuento}% de descuento
                            </div>
                        `;
                    } else {
                        validacionElement.innerHTML = `
                            <div class="codigo-invalido">
                                ‚ùå ${data.mensaje}
                            </div>
                        `;
                        codigoValido = null;
                    }
                }
            } catch (error) {
                // Modo demo
                const codigosDemo = {
                    'PRIMERACITA': { valido: true, tipo: 'cita_gratuita', descuento: 100 },
                    'DESC50': { valido: true, tipo: 'descuento_porcentaje', descuento: 50 },
                    'BIENVENIDA': { valido: true, tipo: 'cita_gratuita', descuento: 100 }
                };
                
                codigoValido = codigosDemo[codigo.toUpperCase()];
                
                if (codigoValido) {
                    validacionElement.innerHTML = `
                        <div class="codigo-valido">
                            ‚úÖ C√≥digo v√°lido: ${codigoValido.descuento}% de descuento
                        </div>
                    `;
                } else {
                    validacionElement.innerHTML = `
                        <div class="codigo-invalido">
                            ‚ùå C√≥digo inv√°lido
                        </div>
                    `;
                }
            }
            
            calcularPrecio();
        }

        function calcularPrecio() {
            let precio = PRECIO_BASE;
            let nota = '';
            
            if (modalidadSeleccionada === 'gratuita') {
                precio = 0;
                nota = 'üéâ ¬°Esta consulta es gratuita!';
            } else if (codigoValido && codigoValido.valido) {
                if (codigoValido.tipo === 'cita_gratuita' || codigoValido.descuento === 100) {
                    precio = 0;
                    nota = 'üéâ ¬°Esta consulta es gratuita!';
                } else {
                    precio = PRECIO_BASE * (1 - codigoValido.descuento / 100);
                    nota = `üí∞ Descuento de ${codigoValido.descuento}% aplicado`;
                }
            }
            
            document.getElementById('precioTotal').textContent = `$${precio.toFixed(2)}`;
            document.getElementById('precioNota').textContent = nota;
        }

        async function agendarCita() {
            const btnSubmit = document.getElementById('btnSubmit');
            btnSubmit.disabled = true;
            btnSubmit.innerHTML = '<span class="loading"></span> Agendando...';
            
            const formData = {
                nombre: document.getElementById('nombre').value,
                apellido: document.getElementById('apellido').value,
                email: document.getElementById('email').value,
                telefono: document.getElementById('telefono').value,
                fecha: document.getElementById('fecha').value,
                hora: document.getElementById('hora').value,
                motivo: document.getElementById('motivo').value,
                notas: document.getElementById('notas').value,
                modalidad: modalidadSeleccionada,
                codigo_promocion: document.getElementById('codigoPromocion').value
            };
            
            const precio = parseFloat(document.getElementById('precioTotal').textContent.replace('$', ''));
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ...formData, precio })
                });
                
                if (response.ok) {
                    mostrarAlerta('success', precio === 0 ? 'üéâ ¬°Cita gratuita agendada exitosamente!' : '‚úÖ ¬°Cita agendada exitosamente!');
                    limpiarFormulario();
                    await cargarCitas();
                    await verificarCitasGratis();
                } else {
                    throw new Error('Error al agendar');
                }
            } catch (error) {
                // Modo demo
                console.log('Modo demo: guardando en localStorage');
                const citas = JSON.parse(localStorage.getItem('citas') || '[]');
                const nuevaCita = {
                    ...formData,
                    precio,
                    id: Date.now(),
                    fecha_creacion: new Date().toISOString(),
                    estado: 'confirmada'
                };
                citas.push(nuevaCita);
                localStorage.setItem('citas', JSON.stringify(citas));
                
                if (modalidadSeleccionada === 'gratuita') {
                    citasGratuitasDisponibles--;
                    localStorage.setItem('citasGratisDisponibles', citasGratuitasDisponibles.toString());
                    actualizarDisplayCitasGratis();
                }
                
                mostrarAlerta('success', precio === 0 ? 'üéâ ¬°Cita gratuita agendada exitosamente! (Modo Demo)' : '‚úÖ ¬°Cita agendada exitosamente! (Modo Demo)');
                limpiarFormulario();
                cargarCitas();
            }
            
            btnSubmit.disabled = false;
            btnSubmit.textContent = 'Agendar Cita';
        }

        function mostrarAlerta(tipo, mensaje) {
            const alertContainer = document.getElementById('alertContainer');
            alertContainer.innerHTML = `
                <div class="alert alert-${tipo} show">
                    <i class="fas fa-${tipo === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    ${mensaje}
                </div>
            `;
            
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        function limpiarFormulario() {
            document.getElementById('citaForm').reset();
            document.getElementById('codigoValidacion').innerHTML = '';
            codigoValido = null;
            modalidadSeleccionada = 'pagada';
            document.querySelectorAll('.modalidad-option').forEach(o => o.classList.remove('active'));
            document.querySelector('[data-modalidad="pagada"]').classList.add('active');
            calcularPrecio();
        }

        async function cargarCitas() {
            try {
                const response = await fetch(API_URL);
                if (response.ok) {
                    const citas = await response.json();
                    renderizarCitas(citas);
                } else {
                    throw new Error('Error al cargar citas');
                }
            } catch (error) {
                // Modo demo
                console.log('Modo demo: cargando desde localStorage');
                const citas = JSON.parse(localStorage.getItem('citas') || '[]');
                renderizarCitas(citas);
            }
        }

        function renderizarCitas(citas) {
            const citasList = document.getElementById('citasList');
            
            if (citas.length === 0) {
                citasList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-alt"></i>
                        <p>No hay citas agendadas</p>
                    </div>
                `;
                return;
            }
            
            // Ordenar por fecha m√°s reciente
            citas.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
            
            citasList.innerHTML = citas.map(cita => {
                const esGratis = cita.precio === 0 || cita.modalidad === 'gratuita';
                const tieneDescuento = cita.precio > 0 && cita.precio < PRECIO_BASE;
                
                return `
                    <div class="cita-item">
                        <div class="cita-header">
                            <div class="cita-nombre">${cita.nombre} ${cita.apellido}</div>
                            <div class="cita-badges">
                                ${esGratis ? '<span class="badge badge-gratis">GRATIS</span>' : ''}
                                ${!esGratis && tieneDescuento ? '<span class="badge badge-descuento">DESCUENTO</span>' : ''}
                                ${!esGratis && !tieneDescuento ? '<span class="badge badge-pagada">PAGADA</span>' : ''}
                            </div>
                        </div>
                        <div class="cita-details">
                            <p><i class="fas fa-calendar"></i> ${formatearFecha(cita.fecha)}</p>
                            <p><i class="fas fa-clock"></i> ${cita.hora}</p>
                            <p><i class="fas fa-envelope"></i> ${cita.email}</p>
                            <p><i class="fas fa-phone"></i> ${cita.telefono}</p>
                            <p><i class="fas fa-file-medical"></i> ${getMotivoTexto(cita.motivo)}</p>
                            <p><i class="fas fa-dollar-sign"></i> $${cita.precio.toFixed(2)}</p>
                        </div>
                        ${cita.notas ? `<div class="cita-notas"><strong>Notas:</strong> ${cita.notas}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function formatearFecha(fecha) {
            const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(fecha + 'T00:00:00').toLocaleDateString('es-ES', opciones);
        }

        function getMotivoTexto(motivo) {
            const motivos = {
                'primera_vez': 'Primera Consulta',
                'ansiedad': 'Ansiedad',
                'depresion': 'Depresi√≥n',
                'estres': 'Estr√©s',
                'relaciones': 'Relaciones',
                'autoestima': 'Autoestima',
                'otro': 'Otro'
            };
            return motivos[motivo] || motivo;
        }
    </script>
</body>
</html>